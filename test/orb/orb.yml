commands:
  install:
    description: Install conftest
    parameters:
      version:
        default: 0.14.0
        description: The version of conftest to install
        type: string
    steps:
    - run:
        command: |
          if [ ! -f ${HOME}/.conftest/bin/conftest ]; then
            mkdir -p ${HOME}/.conftest/bin
            wget https://github.com/instrumenta/conftest/releases/download/v<< parameters.version >>/conftest_<< parameters.version >>_Linux_x86_64.tar.gz
            tar xzf conftest_<< parameters.version >>_Linux_x86_64.tar.gz
            mv conftest ${HOME}/.conftest/bin
            chmod +x ${HOME}/.conftest/bin/conftest
            # Add to PATH
            echo 'export PATH=${HOME}/.conftest/bin:$PATH' >> $BASH_ENV
            source $BASH_ENV
          fi
          conftest --version
        name: Download the CLI
  test:
    description: Test your configuration files using conftest
    parameters:
      fail_on_warn:
        default: false
        description: Return a non-zero exit code when warnings are found.
        type: boolean
      file:
        description: Return
        type: string
      namespace:
        default: main
        description: Namespace in which to find deny and warn rules.
        type: string
      policy_path:
        default: policy
        description: Path to the Rego policy files directory. For the test command,
          specifying a specific .rego file is allowed.
        type: string
    steps:
    - run:
        command: |
          conftest test --namespace << parameters.namespace >> --policy << parameters.policy_path >> <<# parameters.fail_on_warn >>--fail-on-warn<</ parameters.fail_on_warn >> << parameters.file >>
        name: Run conftest test
description: |
  Easily integrate Conftest View this orb's source: https://github.com/kenfdev/conftest-orb
executors:
  alpine:
    docker:
    - image: cibuilds/base:latest
    resource_class: small
version: 2.1

